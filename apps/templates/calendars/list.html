{% extends "base.html" %}
{% load static %}
{% load event_color %}
{% load crispy_forms_tags %}

{% block title %} Calendar Events {% endblock title %}

{% block extra_css %}
{% endblock extra_css %}
    <style>
        .htmx-indicator{
            display:none !important;
        }
        .htmx-request .my-indicator{
            display:inline;
        }
        .htmx-request.my-indicator{
            display:inline;
        }
    </style>

{% block content %}
        <div class="d-flex justify-content-start my-4">
            <h4>Calendar Events</h4>
            <a class="btn btn-secondary ms-2" role="button" href="{% url 'calendars:create' %}">Create Event</a>
        </div>
            <form class="d-flex" action="." method="get">
                    {{ form | crispy }}
                <div class="mb-3">
                    <label class="form-label">.</label>
                <button class="form-control btn btn-primary" type="submit">Search</button>
                </div>
            </form>
        {% if event_search is not None %}
            Search: {{ event_search | safe }}
        {% endif %}
        <div>
            <div class="row row-cols-1 row-cols-md-4 g-4">
                {% for event in events %}
                    <div class="col">
                        <div class="card h-100" style="{% event_color color_id=event.color_id %};">
                            <div class="card-body">
                                <h6 class="card-title">{{ event.summary | capfirst }}</h6>
                                {% if event.description %}
                                <p class="card-text">
                                    {{ event.description }}
                                </p>
                                {% endif %}
                                <small>
                                    Start date: {{ event.start | date }} <br>
                                    End date: {{ event.end | date }} <br>
                                    Created by: {{ event.creator }} <br>
                                </small>
                            </div>
                            <small class="d-flex justify-content-end mb-2 me-2">
                                <a role="button" href="{% url 'calendars:update' event.id %}" class="btn btn-sm btn-outline-primary ms-2">
                                    Edit
                                </a>

                                <a role="button" hx-indicator="#delete_indicator_{{ event.id }}" hx-confirm="Êtes-vous sure de vouloir supprimer cet évènement ? " hx-post="{% url 'calendars:delete' event.id %}" class="btn btn-sm btn-outline-danger ms-2">
                                    <div id="delete_indicator_{{ event.id }}" class="htmx-indicator spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    Delete
                                </a>
                            </small>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-end">
            {% if events.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ events.previous_page_number }}">Previous</a>
                </li>
            {% endif %}
            {% for num in events.adjusted_elided_pages %}
                {% if num == events.paginator.ELLIPSIS %}
                    <li class="page-item">
                        <a href="#" class="page-link">{{ num }}</a>
                    </li>
                {% else %}
                    {% if events.number == num %}
                        <li class="page-item active">
                            <a class="page-link">{{ events.number }}</a>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a href="?page={{ num }}" class="page-link">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endif %}
            {% endfor %}
              {% if events.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ events.next_page_number }}">Next</a>
              </li>
              {% endif %}
            </ul>
          </nav>
{% endblock content %}
